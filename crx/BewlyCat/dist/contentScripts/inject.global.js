(function(){"use strict";function x(){return typeof navigator>"u"?!1:!!/Electron/i.test(navigator.userAgent)}let p=null,b=!1;if(x())console.warn("[BewlyCat] Detected Electron environment, extension disabled.");else{let E=function(t,o,i){let n;U(o)?n=o:n=[o];const r=n.reduce((e,l)=>(e[l]=t[l],e),{});return n.map(e=>t[e]),n.forEach(e=>{const l=(...s)=>(i(...s),r[e].apply(t,s));l.toString=t[e].toString,t[e]=l}),{originKeysValue:r,restore:()=>{for(const e in r)t[e]=r[e].bind(t)}}},q=function(t){const o=t?.reply_control?.location;return typeof o!="string"?o:o.replace(/^IP属地[：: ]*/u,"")},A=function(t){return t?.member?.sex},M=function(){const t=p?.language||"cmn-CN";return N[t]??"楼主"},d=function(t){return t==null||t===""?null:String(t)},C=function(t){return d(t?.oid_str??t?.oid)},g=function(t){return d(t?.rpid_str??t?.rpid)},v=function(t){return d(t?.root_str??t?.root)},h=function(t){return d(t?.member?.mid)},T=function(t,o){const i=C(t);return i?`${i}:${o}`:o},L=function(t){const o=g(t),i=v(t),n=h(t);if(!o||!n||!(!i||i==="0"||i===o))return;const e=T(t,o);w.set(e,n)},B=function(t,o){const i=document.querySelectorAll("bili-comment-user-info");for(let n=0;n<i.length;n+=1){const e=i[n]?.data;if(!e||g(e)!==o)continue;const s=h(e);if(s)return s}return null},H=function(t){const o=v(t);if(!o||o==="0")return!1;const i=h(t);if(!i)return!1;const n=T(t,o);let r=w.get(n);return r||(r=B(t,o)??void 0,r&&w.set(n,r)),r===i},m=function(t,o,i,n,r){if(!t)return null;let e=t.querySelector(`#${o}`);if(!i||!r)return e&&e.remove(),null;if(e||(e=document.createElement("div"),e.id=o,r.insertAdjacentElement("afterend",e)),o==="sex")if(e.style.cssText="display: inline-flex; align-items: center; margin-left: 4px; vertical-align: middle;",e.innerHTML="",n==="男")e.innerHTML='<svg viewBox="0 0 24 24" width="14" height="14" fill="#00a1d6" style="display: block;"><path d="M20 4v6h-2V7.425l-3.975 3.95q.475.7.725 1.488T15 14.5q0 2.3-1.6 3.9T9.5 20q-2.3 0-3.9-1.6T4 14.5q0-2.3 1.6-3.9T9.5 9q.825 0 1.625.237t1.475.738L16.575 6H14V4zM9.5 11q-1.45 0-2.475 1.025T6 14.5q0 1.45 1.025 2.475T9.5 18q1.45 0 2.475-1.025T13 14.5q0-1.45-1.025-2.475T9.5 11"/></svg>';else if(n==="女")e.innerHTML='<svg viewBox="0 0 24 24" width="14" height="14" fill="#fb7299" style="display: block;"><path d="M11 21v-2H9v-2h2v-2.1q-1.975-.35-3.238-1.888T6.5 9.45q0-2.275 1.613-3.862T12 4t3.888 1.588T17.5 9.45q0 2.025-1.263 3.563T13 14.9V17h2v2h-2v2zm1-8q1.45 0 2.475-1.025T15.5 9.5q0-1.45-1.025-2.475T12 6q-1.45 0-2.475 1.025T8.5 9.5q0 1.45 1.025 2.475T12 13"/></svg>';else return e.remove(),null;else o==="location"?(e.style.cssText="display: inline-block; margin-left: 4px; padding: 1px 4px; font-size: 11px; color: var(--bew-ip-tag-text); background-color: var(--bew-ip-tag-bg); border-radius: 3px; vertical-align: middle; line-height: 1.4;",e.textContent=String(n)):(o==="host-tag"&&(e.style.cssText="display: inline-block; margin-left: 4px; padding: 1px 4px; font-size: 11px; font-weight: 500; color: var(--bew-theme-color); background-color: var(--bew-theme-color-10); border-radius: 3px; vertical-align: middle; line-height: 1.4;"),e.textContent=String(n));return e},_=function(){const t=window.location.href;return/https?:\/\/(?:www\.|m\.)?bilibili\.com\/video\/.*/.test(t)||/https?:\/\/(?:www\.|m\.)?bilibili\.com\/s\/video\/.*/.test(t)||/https?:\/\/(?:www\.|m\.)?bilibili\.com\/bangumi\/play\/.*/.test(t)||/https?:\/\/t\.bilibili\.com(?!\/vote|\/share).*/.test(t)||/https?:\/\/(?:www\.)?bilibili\.com\/opus\/.*/.test(t)||/https?:\/\/space\.bilibili\.com\/.*/.test(t)||/https?:\/\/(?:www\.)?bilibili\.com\/read\/.*/.test(t)||/https?:\/\/(?:www\.)?bilibili\.com\/v\/topic\/detail.*/.test(t)||/https?:\/\/(?:www\.|m\.)?bilibili\.com\/cheese\/play\/.*/.test(t)||/https?:\/\/(?:www\.)?bilibili\.com\/watchlater\/(?:#\/)?list.*/.test(t)||/https?:\/\/(?:www\.)?bilibili\.com\/list\/watchlater(?:\?.*|\/.*)?$/.test(t)||/https?:\/\/(?:www\.)?bilibili\.com\/list\/ml.*/.test(t)||/https?:\/\/(?:www\.)?bilibili\.com\/medialist\/(?:play|detail)\/.*/.test(t)||/https?:\/\/(?:www\.|m\.)?bilibili\.com\/blackboard\/.*/.test(t)||/https?:\/\/(?:www\.|m\.)?bilibili\.com\/festival\/.*/.test(t)||/https?:\/\/manga\.bilibili\.com\/detail\/.*/.test(t)};const U=t=>Array.isArray(t);E(window.history,["pushState"],(...t)=>{window.dispatchEvent(new CustomEvent("pushstate",{detail:t}))});const N={en:"OP","cmn-TW":"樓主",jyut:"樓主","cmn-CN":"楼主"},w=new Map;if(window.customElements&&_()){const{define:t}=window.customElements;window.customElements.define=new Proxy(t,{apply:(o,i,n)=>{const[r,e]=n;if(typeof e!="function")return Reflect.apply(o,i,n);if(r==="bili-comment-pictures-renderer"){const l=e.prototype.update;return e.prototype.update=function(...s){const u=l.apply(this,s),c=this.shadowRoot;if(!c)return u;if(p?.adjustCommentImageHeight){const a=c.querySelector("#content");a&&!a.classList.contains("flex")&&a.querySelectorAll("img").forEach(f=>{f.removeAttribute("height"),f.style.height="auto"})}return u},Reflect.apply(o,i,n)}if(r==="bili-comment-user-info"){const l=e.prototype.update;return e.prototype.update=function(...s){const u=l.apply(this,s),c=this.shadowRoot;if(!c)return u;const a=c.querySelector("#user-name");if(a){L(this.data);const y=A(this.data),f=!!(p?.showSex&&y),R=m(c,"sex",f,y,a),P=!!(p?.showCommentHostTag&&H(this.data)),z=R??a,V=m(c,"host-tag",P,M(),z),S=q(this.data),k=!!(p?.showIPLocation&&S);m(c,"location",k,S,V??R??a)}return u},Reflect.apply(o,i,n)}if(r==="bili-comment-action-buttons-renderer"){const l=e.prototype.update;return e.prototype.update=function(...s){return l.apply(this,s)},Reflect.apply(o,i,n)}if(r==="bili-comments-vote-card"){const l=e.prototype.update;return e.prototype.update=function(...s){const u=l.apply(this,s),c=this.shadowRoot;if(!c)return u;if(!c.querySelector("#bewly-vote-card-style")){const a=document.createElement("style");a.id="bewly-vote-card-style",a.textContent=`
              :host {
                --option-color: var(--bew-text-1, #18191c) !important;
              }
            `,c.appendChild(a)}return u},Reflect.apply(o,i,n)}return Reflect.apply(o,i,n)}})}window.addEventListener("message",t=>{if(t.source!==window)return;const{type:o,data:i}=t.data;if(o==="BEWLY_SETTINGS_UPDATE"&&i){const n=!b;p=i,b=!0,n&&i.enableVolumeNormalization&&console.log("[AudioInterceptor] 音量均衡已启用")}}),window.postMessage({type:"BEWLY_REQUEST_SETTINGS"},"*")}})();
